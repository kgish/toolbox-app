/*
@license

dhtmlxGantt v.4.1.0 Professional
This software is covered by DHTMLX Commercial License. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
gantt._formatLink=function(t){var n=[],e=this._get_link_target(t),a=this._get_link_source(t);if(!a||!e)return n;if(gantt.isChildOf(a.id,e.id)&&gantt._isProject(e)||gantt.isChildOf(e.id,a.id)&&gantt._isProject(a))return n;for(var i=this._getImplicitLinks(t,a,function(t){return 0}),r=gantt.config.auto_scheduling_move_projects,o=this._isProject(e)?this.getSubtaskDates(e.id):{start_date:e.start_date,end_date:e.end_date},g=this._getImplicitLinks(t,e,function(t){return r?t.$target.length?0:gantt.calculateDuration(gantt.roundDate(o.start_date),gantt.roundDate(t.start_date)):0;
}),s=0;s<i.length;s++)for(var u=i[s],c=0;c<g.length;c++){var l=g[c],d=u.lag+l.lag,h=gantt.copy(t);h.source=u.task,h.target=l.task,h.lag=(h.lag||0)+d,n.push(gantt._convertToFinishToStartLink(l.task,h,a,e))}return n},gantt._getImplicitLinks=function(t,n,e){var a=[];return this._isProject(n)?this.eachTask(function(t){this._isProject(t)||a.push({task:t.id,lag:e(t)})},n.id):a.push({task:n.id,lag:0}),a},gantt._getDirectDependencies=function(t,n){for(var e=[],a=[],i=n?t.$source:t.$target,r=0;r<i.length;r++){
var o=this.getLink(i[r]);this.isTaskExists(o.source)&&this.isTaskExists(o.target)&&e.push(this.getLink(i[r]))}for(var r=0;r<e.length;r++)a=a.concat(this._formatLink(e[r]));return a},gantt._getInheritedDependencies=function(t,n){var e=[],a=[];if(this.isTaskExists(t.id)){this._eachParent(function(t){this._isProject(t)&&a.push.apply(a,this._getDirectDependencies(t,n))},t.id,this);for(var i=0;i<a.length;i++){var r=n?a[i].source:a[i].target;r==t.id&&e.push(a[i])}}return e},gantt._getDirectSuccessors=function(t){
return this._getDirectDependencies(t,!0)},gantt._getInheritedSuccessors=function(t){return this._getInheritedDependencies(t,!0)},gantt._getDirectPredecessors=function(t){return this._getDirectDependencies(t,!1)},gantt._getInheritedPredecessors=function(t){return this._getInheritedDependencies(t,!1)},gantt._getSuccessors=function(t){return this._getDirectSuccessors(t).concat(this._getInheritedSuccessors(t))},gantt._getPredecessors=function(t){return this._getDirectPredecessors(t).concat(this._getInheritedPredecessors(t));
},gantt._convertToFinishToStartLink=function(t,n,e,a){var i={target:t,link:gantt.config.links.finish_to_start,id:n.id,lag:n.lag||0,source:n.source,preferredStart:null},r=0;switch(n.type){case gantt.config.links.start_to_start:r=-e.duration;break;case gantt.config.links.finish_to_finish:r=-a.duration;break;case gantt.config.links.start_to_finish:r=-e.duration-a.duration;break;default:r=0}return i.lag+=r,i},gantt.config.auto_scheduling=!1,gantt.config.auto_scheduling_descendant_links=!1,gantt.config.auto_scheduling_initial=!0,
gantt.config.auto_scheduling_strict=!1,gantt.config.auto_scheduling_move_projects=!0,gantt._forEach=function(t,n){for(var e=t.slice(),a=0;a<e.length;a++)n(e[a],a)},gantt._arrayMap=function(t,n){for(var e=t.slice(),a=[],i=0;i<e.length;i++)a.push(n(e[i],i));return a},gantt._autoSchedulingGraph={getVertices:function(t){var n={};gantt._forEach(t,function(t){n[t.target]=t.target,n[t.source]=t.source});var e=[];for(var a in n)e.push(n[a]);return e.sort(function(t,n){return gantt.getGlobalTaskIndex(t)-gantt.getGlobalTaskIndex(n);
})},topologicalSort:function(t){for(var n=this.getVertices(t),e=n.reduce(function(t,n){return t[n]={id:n,$source:[],$target:[],$incoming:0},t},{}),a=0;a<t.length;a++){var i=e[t[a].target];i.$target.push(a),i.$incoming=i.$target.length,e[t[a].source].$source.push(a)}for(var r=n.filter(function(t){return!e[t].$incoming}),o=[];r.length;){var g=r.pop();o.push(g);for(var s=e[g],a=0;a<s.$source.length;a++){var u=e[t[s.$source[a]].target];u.$incoming--,u.$incoming||r.push(u.id)}}return o},tarjanStronglyConnectedComponents:function(t,n){
function e(t,i){var u=a(t);if(u.index=r,u.lowLink=r,r++,i&&g.push(i),o.push(u),u.onStack=!0,gantt._forEach(n,function(n){if(n.source==t){var i=a(n.source),r=a(n.target);void 0===r.index?(e(n.target,n),i.lowLink=Math.min(i.lowLink,r.lowLink)):r.onStack&&(i.lowLink=Math.min(i.lowLink,r.index),g.push(n))}}),u.lowLink==u.index){var c,l={tasks:[],links:[]};do{var d=g.pop();c=o.pop(),c.onStack=!1,l.tasks.push(c.id),d&&l.links.push(d.id)}while(c.id!=u.id);s.push(l)}}function a(t){return i[t]||(i[t]={id:t
}),i[t]}var i={},r=0,o=[],g=[],s=[];return gantt._forEach(t,function(t){var n=a(t);void 0===n.index&&e(t)}),s}},gantt._autoSchedulingPath={getKey:function(t){return[t.lag,t.link,t.source,t.target].join("_")},getVirtualRoot:function(){return gantt.mixin(gantt.getSubtaskDates(),{id:gantt.config.root_id,type:gantt.config.types.project,$source:[],$target:[],$virtual:!0})},filterDuplicates:function(t){for(var n={},e=0;e<t.length;e++){var a=this.getKey(t[e]);n[a]?(t.splice(e,1),e--):n[a]=!0}return t},getLinkedTasks:function(t,n){
for(var e=[t],a=[],i={},r=0;r<e.length;r++)a=a.concat(this._getLinkedTasks(e[r],i,n));return a},_getLinkedTasks:function(t,n,e){var a=void 0===t?gantt.config.root_id:t,i=n||{},r=gantt.isTaskExists(a)?gantt.getTask(a):this.getVirtualRoot(),o=gantt._getSuccessors(r);e&&o.push.apply(o,gantt._getPredecessors(r));for(var g=[],s=0;s<o.length;s++)i[this.getKey(o[s])]||(i[this.getKey(o[s])]=!0,g=g.concat(this._getLinkedTasks(o[s].target,i,!0)));for(var u=gantt.getChildren(r.id),s=0;s<u.length;s++)o=o.concat(this._getLinkedTasks(u[s],i,!0));
return this.filterDuplicates(o.concat(g))},findLoops:function(t){var n=[];gantt._forEach(t,function(t){t.target==t.source&&n.push([t.target,t.source])});var e=gantt._autoSchedulingGraph,a=e.getVertices(t),i=e.tarjanStronglyConnectedComponents(a,t);return gantt._forEach(i,function(t){t.tasks.length>1&&n.push(t)}),n}},gantt._autoSchedulingDateResolver={isFirstSmaller:function(t,n){return t.valueOf()<n.valueOf()&&gantt._hasDuration(t,n)?!0:!1},isSmallerOrDefault:function(t,n){return!(t&&!this.isFirstSmaller(t,n));
},resolveRelationDate:function(t,n,e){for(var a=null,i=null,r=null,o=0;o<n.length;o++){var g=n[o];t=g.target,r=g.preferredStart;var s=this.getConstraintDate(g,e);this.isSmallerOrDefault(r,s)&&this.isSmallerOrDefault(a,s)&&(a=s,i=g.id)}return{link:i,task:t,start_date:a}},getConstraintDate:function(t,n){var e=n(t.source);return e&&t.lag&&1*t.lag==t.lag&&(e=gantt.calculateEndDate(e,1*t.lag)),e}},gantt._autoSchedulingPlanner={generatePlan:function(t){function n(t){var n=r[t],e=gantt.getTask(t);return n&&(n.start_date||n.end_date)?n.end_date?n.end_date:gantt.calculateEndDate(n.start_date,e.duration,gantt.config.duration_unit):gantt.getClosestWorkTime({
date:e.end_date,dir:"future"})}var e=gantt._autoSchedulingGraph,a=e.topologicalSort(t),i={},r={};gantt._arrayMap(a,function(t){var n=gantt.getTask(t);n.auto_scheduling!==!1&&(i[t]=[],r[t]=null)});for(var o=0;o<t.length;o++)i[t[o].target].push(t[o]);for(var g=gantt._autoSchedulingDateResolver,s=[],o=0;o<a.length;o++){var u=a[o],c=g.resolveRelationDate(u,i[u],n);r[u]=c,c.start_date&&s.push(c)}return s},applyProjectPlan:function(t){for(var n,e,a,i,r=[],o=0;o<t.length;o++)if(a=null,i=null,n=t[o],n.task){
e=gantt.getTask(n.task),n.link&&(a=gantt.getLink(n.link),i=gantt.getTask(a.source));var g=null;if(n.start_date&&e.start_date.valueOf()!=n.start_date.valueOf()&&(g=n.start_date),g){if(gantt.callEvent("onBeforeTaskAutoSchedule",[e,g,a,i])===!1)break;e.start_date=g,e.end_date=gantt.calculateEndDate(e.start_date,e.duration,gantt.config.duration_unit),r.push(e.id),gantt.callEvent("onAfterTaskAutoSchedule",[e,g,a,i])}}return r}},gantt._autoSchedulingPreferredDates=function(t,n){for(var e=0;e<n.length;e++){
var a=n[e],i=gantt.getTask(a.target);gantt.config.auto_scheduling_strict&&a.target!=t||(a.preferredStart=new Date(i.start_date))}},gantt._autoSchedule=function(t,n,e){if(gantt.callEvent("onBeforeAutoSchedule",[t])!==!1){gantt._autoscheduling_in_progress=!0;var a=gantt._autoSchedulingPath,i=[],r=a.findLoops(n);if(r.length)gantt.callEvent("onAutoScheduleCircularLink",[r]);else{var o=gantt._autoSchedulingPlanner;gantt._autoSchedulingPreferredDates(t,n);var g=o.generatePlan(n);i=o.applyProjectPlan(g),
e&&e(i)}return gantt._autoscheduling_in_progress=!1,gantt.callEvent("onAfterAutoSchedule",[t,i]),i}},gantt.autoSchedule=function(t,n){n=void 0===n?!0:!!n;var e=gantt._autoSchedulingPath.getLinkedTasks(t,n);gantt._autoSchedule(t,e,gantt._finalizeAutoSchedulingChanges)},gantt._finalizeAutoSchedulingChanges=function(t){gantt.batchUpdate(function(){for(var n=0;n<t.length;n++)gantt.updateTask(t[n])})},gantt.isCircularLink=function(t){return!!gantt._getConnectedGroup(t)},gantt._getConnectedGroup=function(t){
var n=gantt._autoSchedulingPath,e=n.getLinkedTasks();gantt.isLinkExists(t.id)||(e=e.concat(gantt._formatLink(t)));for(var a=n.findLoops(e),i=!1,r=0;r<a.length&&!i;r++)for(var o=a[r].links,g=0;g<o.length;g++)if(o[g]==t.id)return a[r];return null},gantt.findCycles=function(){var t=gantt._autoSchedulingPath,n=t.getLinkedTasks();return t.findLoops(n)},gantt._attachAutoSchedulingHandlers=function(){gantt._autoScheduleAfterLinkChange=function(t,n){gantt.config.auto_scheduling&&!this._autoscheduling_in_progress&&gantt.autoSchedule(n.source);
},gantt.attachEvent("onAfterLinkUpdate",gantt._autoScheduleAfterLinkChange),gantt.attachEvent("onAfterLinkAdd",gantt._autoScheduleAfterLinkChange),gantt.attachEvent("onParse",function(){gantt.config.auto_scheduling&&gantt.config.auto_scheduling_initial&&gantt.autoSchedule()}),gantt._preventCircularLink=function(t,n){return gantt.isCircularLink(n)?(gantt.callEvent("onCircularLinkError",[n,gantt._getConnectedGroup(n)]),!1):!0},gantt._preventDescendantLink=function(t,n){var e=gantt.getTask(n.source),a=gantt.getTask(n.target);
return!gantt.config.auto_scheduling_descendant_links&&(gantt.isChildOf(e.id,a.id)&&gantt._isProject(a)||gantt.isChildOf(a.id,e.id)&&gantt._isProject(e))?!1:!0},gantt.attachEvent("onBeforeLinkAdd",gantt._preventCircularLink),gantt.attachEvent("onBeforeLinkAdd",gantt._preventDescendantLink),gantt.attachEvent("onBeforeLinkUpdate",gantt._preventCircularLink),gantt.attachEvent("onBeforeLinkUpdate",gantt._preventDescendantLink),gantt._datesNotEqual=function(t,n){return t.valueOf()>n.valueOf()?this._hasDuration(n,t):this._hasDuration(t,n);
},gantt._notEqualTaskDates=function(t,n){return this._datesNotEqual(t.start_date,n.start_date)||(this._datesNotEqual(t.end_date,n.end_date)||t.duration!=n.duration)&&t.type!=gantt.config.types.milestone?!0:void 0};var t,n;gantt.attachEvent("onBeforeTaskDrag",function(e,a,i){return gantt.config.auto_scheduling_move_projects&&(t=gantt._autoSchedulingPath.getLinkedTasks(e,!0),n=e),!0}),gantt._autoScheduleAfterDND=function(e,a){if(gantt.config.auto_scheduling&&!this._autoscheduling_in_progress){var i=this.getTask(e);
gantt._notEqualTaskDates(a,i)&&(gantt.config.auto_scheduling_move_projects&&n==e?gantt._autoSchedule(e,t,gantt._finalizeAutoSchedulingChanges):gantt.autoSchedule(i.id))}return t=null,n=null,!0},gantt._lightBoxChangesHandler=function(t,n){if(gantt.config.auto_scheduling&&!this._autoscheduling_in_progress){var e=this.getTask(t);gantt._notEqualTaskDates(n,e)&&(gantt._autoschedule_lightbox_id=t)}return!0},gantt._lightBoxSaveHandler=function(t,n){return gantt.config.auto_scheduling&&!this._autoscheduling_in_progress&&gantt._autoschedule_lightbox_id&&gantt._autoschedule_lightbox_id==t&&(gantt._autoschedule_lightbox_id=null,
gantt.autoSchedule(n.id)),!0},gantt.attachEvent("onBeforeTaskChanged",function(t,n,e){return gantt._autoScheduleAfterDND(t,e)}),gantt.attachEvent("onLightboxSave",gantt._lightBoxChangesHandler),gantt.attachEvent("onAfterTaskUpdate",gantt._lightBoxSaveHandler)},gantt.attachEvent("onGanttReady",function(){gantt._attachAutoSchedulingHandlers()});
//# sourceMappingURL=../sources/ext/dhtmlxgantt_auto_scheduling.js.map